{"files":[{"id":"aaf4ded0-7357-4a94-9872-e45967c2ea13","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Tokyo\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"3aa03e64-985a-47d5-a237-670f0a739775","name":"コード","type":"server_js","source":"// アクセスURL\n// https://script.google.com/macros/s/AKfycbyFI8EktR0YtlyKuwkMauNOm-sY7m9lrFK5DVEfpEPBQB1l4NqcB_3hJXYvuAS7kgST/exec\n\n// スプレッドシートIDとシート名を指定\nconst SHEET_ID \u003d \u00271SxOT4VZCeUuzjp8kgNm11iPx4YsklnDg0xElzRbp_1Y\u0027;\nconst SHEET_NAME \u003d \u0027items\u0027;\n\nfunction doGet(e) {\n  const action \u003d e.parameter.action;\n  if (action \u003d\u003d\u003d \u0027list\u0027) return listItems();\n  return ContentService.createTextOutput(\u0027Invalid GET action\u0027);\n}\n\nfunction doPost(e) {\n  const action \u003d e.parameter.action;\n  if (action \u003d\u003d\u003d \u0027add\u0027) return addItem(e);\n  if (action \u003d\u003d\u003d \u0027update\u0027) return updateItem(e);\n  if (action \u003d\u003d\u003d \u0027delete\u0027) return deleteItem(e);\n  return ContentService.createTextOutput(\u0027Invalid POST action\u0027);\n}\n\n// 一覧取得\nfunction listItems() {\n  const sheet \u003d SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);\n  const data \u003d sheet.getDataRange().getValues();\n  const items \u003d [];\n\n  for (let i \u003d 1; i \u003c data.length; i++) {\n    const row \u003d data[i];\n    items.push({\n      id: row[0],\n      name: row[1],\n      price: row[2] || null,\n      deadline: row[3] || null,\n      status: row[4]\n    });\n  }\n\n  return ContentService.createTextOutput(JSON.stringify(items))\n    .setMimeType(ContentService.MimeType.JSON);\n}\n\n// 新規追加\nfunction addItem(e) {\n  const sheet \u003d SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);\n  const id \u003d Utilities.getUuid();\n  const name \u003d e.parameter.name;\n  const price \u003d e.parameter.price || \u0027\u0027;\n  const deadline \u003d e.parameter.deadline || \u0027\u0027;\n  const status \u003d \u0027pending\u0027;\n\n  sheet.appendRow([id, name, price, deadline, status]);\n\n  const item \u003d { id, name, price, deadline, status };\n  return ContentService.createTextOutput(JSON.stringify(item))\n    .setMimeType(ContentService.MimeType.JSON);\n}\n\n// ステータス更新\nfunction updateItem(e) {\n  const sheet \u003d SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);\n  const id \u003d e.parameter.id;\n  const status \u003d e.parameter.status;\n\n  const data \u003d sheet.getDataRange().getValues();\n  for (let i \u003d 1; i \u003c data.length; i++) {\n    if (data[i][0] \u003d\u003d\u003d id) {\n      sheet.getRange(i + 1, 5).setValue(status);\n      const item \u003d {\n        id: data[i][0],\n        name: data[i][1],\n        price: data[i][2] || null,\n        deadline: data[i][3] || null,\n        status: status\n      };\n      return ContentService.createTextOutput(JSON.stringify(item))\n        .setMimeType(ContentService.MimeType.JSON);\n    }\n  }\n\n  return ContentService.createTextOutput(JSON.stringify({ error: \u0027Item not found\u0027 }))\n    .setMimeType(ContentService.MimeType.JSON);\n}\n\n// 削除\nfunction deleteItem(e) {\n  const sheet \u003d SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);\n  const id \u003d e.parameter.id;\n  const data \u003d sheet.getDataRange().getValues();\n\n  for (let i \u003d 1; i \u003c data.length; i++) {\n    if (data[i][0] \u003d\u003d\u003d id) {\n      sheet.deleteRow(i + 1);\n      return ContentService.createTextOutput(JSON.stringify({ message: \u0027Deleted\u0027 }))\n        .setMimeType(ContentService.MimeType.JSON);\n    }\n  }\n\n  return ContentService.createTextOutput(JSON.stringify({ error: \u0027Item not found\u0027 }))\n    .setMimeType(ContentService.MimeType.JSON);\n}\n"}]}